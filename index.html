<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Visual Flexible Pro - IA & Mockups</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #5C7CFA 0%, #7950F2 100%);
            color: white;
            padding: 30px 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header .badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-top: 10px;
        }

        .content {
            padding: 40px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
        }

        .tab.active {
            background: linear-gradient(135deg, #5C7CFA 0%, #7950F2 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(92, 124, 250, 0.3);
        }

        .tab:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .module {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .module h2 {
            color: #5C7CFA;
            margin-bottom: 20px;
            font-size: 1.8em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .upload-area {
            border: 3px dashed #5C7CFA;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }

        .upload-area:hover {
            border-color: #7950F2;
            background: #f8f9fa;
        }

        .upload-area.dragging {
            border-color: #7950F2;
            background: #e7f5ff;
        }

        .image-preview {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }

        .preview-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .preview-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            display: block;
        }

        .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 59, 48, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 18px;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(55, 178, 77, 0.3);
            transition: all 0.3s;
        }

        .analyze-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(55, 178, 77, 0.4);
        }

        .analyze-btn:disabled {
            background: #adb5bd;
            cursor: not-allowed;
            box-shadow: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #5C7CFA;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .analysis-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .analysis-section h3 {
            color: #5C7CFA;
            margin-bottom: 15px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-content {
            color: #495057;
            line-height: 1.8;
        }

        .analysis-content ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .analysis-content li {
            margin-bottom: 8px;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .color-item {
            text-align: center;
        }

        .color-swatch {
            width: 100%;
            height: 100px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .color-swatch:hover {
            transform: scale(1.05);
        }

        .color-code {
            font-size: 0.9em;
            color: #495057;
            font-family: monospace;
        }

        .option-chip {
            padding: 8px 16px;
            background: #e7f5ff;
            border: 2px solid #5C7CFA;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.9em;
            display: inline-block;
            margin: 5px;
        }

        .option-chip:hover {
            background: #5C7CFA;
            color: white;
        }

        .option-chip.selected {
            background: #5C7CFA;
            color: white;
        }

        .generate-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.3);
            transition: all 0.3s;
        }

        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(255, 107, 107, 0.4);
        }

        .mockup-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .mockup-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .mockup-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .mockup-preview {
            width: 100%;
            height: 250px;
            border-radius: 8px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .mockup-title {
            font-size: 1.1em;
            font-weight: 600;
            color: #495057;
            margin-bottom: 10px;
        }

        .mockup-info {
            font-size: 0.9em;
            color: #868e96;
            margin-bottom: 15px;
        }

        .download-btn {
            width: 100%;
            background: #5C7CFA;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .download-btn:hover {
            background: #4c6ef5;
        }

        .info-box {
            background: #e7f5ff;
            border-left: 4px solid #339af0;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #5C7CFA;
        }

        .stat-label {
            color: #868e96;
            margin-top: 5px;
        }

        .form-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .ai-badge {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 600;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .result-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .result-preview {
            width: 100%;
            height: 200px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            color: white;
        }

        .input-group {
            margin: 20px 0;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #5C7CFA;
        }

        .tag {
            display: inline-block;
            background: #e9ecef;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            margin: 3px;
            color: #495057;
        }

        .variation-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }

        .visual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .visual-item {
            background: white;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .visual-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .visual-item svg {
            width: 100%;
            height: auto;
            max-height: 120px;
        }

        .visual-label {
            margin-top: 8px;
            font-size: 0.85em;
            color: #495057;
            font-weight: 600;
        }

        .section-subtitle {
            color: #5C7CFA;
            font-size: 1.1em;
            font-weight: 600;
            margin: 20px 0 15px 0;
            padding-bottom: 8px;
            border-bottom: 2px solid #e9ecef;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function SistemaVisualFlexiblePro() {
            const [activeTab, setActiveTab] = useState('analisis');
            const [uploadedImages, setUploadedImages] = useState([]);
            const [analyzing, setAnalyzing] = useState(false);
            const [aiAnalysis, setAiAnalysis] = useState(null);
            const [colorPalette, setColorPalette] = useState([]);
            const [morphologicalMatrix, setMorphologicalMatrix] = useState({
                A: [],
                B: [],
                C: [],
                D: []
            });
            const [selectedOptions, setSelectedOptions] = useState({
                A: [],
                B: [],
                C: [],
                D: []
            });
            const [generatedVariations, setGeneratedVariations] = useState([]);
            const [mockups, setMockups] = useState([]);
            const [generatingMockups, setGeneratingMockups] = useState(false);
            const [isDragging, setIsDragging] = useState(false);

            const fileInputRef = useRef(null);

            const handleFileUpload = (files) => {
                const newImages = Array.from(files).map(file => ({
                    file,
                    url: URL.createObjectURL(file),
                    id: Math.random().toString(36)
                }));
                setUploadedImages(prev => [...prev, ...newImages]);
            };

            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragging(false);
                const files = e.dataTransfer.files;
                handleFileUpload(files);
            };

            const removeImage = (id) => {
                setUploadedImages(prev => prev.filter(img => img.id !== id));
            };

            const extractColors = async (imageUrl, numColors = 8) => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.crossOrigin = 'Anonymous';
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);

                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const pixels = imageData.data;
                        const colorMap = {};

                        for (let i = 0; i < pixels.length; i += 40) {
                            const r = pixels[i];
                            const g = pixels[i + 1];
                            const b = pixels[i + 2];
                            const key = `${Math.floor(r/10)*10},${Math.floor(g/10)*10},${Math.floor(b/10)*10}`;
                            colorMap[key] = (colorMap[key] || 0) + 1;
                        }

                        const sortedColors = Object.entries(colorMap)
                            .sort((a, b) => b[1] - a[1])
                            .slice(0, numColors)
                            .map(([color]) => {
                                const [r, g, b] = color.split(',').map(Number);
                                return { r, g, b, hex: `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1)}` };
                            });

                        resolve(sortedColors);
                    };
                    img.src = imageUrl;
                });
            };

            const imageToBase64 = (file) => {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => {
                        const base64 = reader.result.split(",")[1];
                        resolve(base64);
                    };
                    reader.onerror = () => reject(new Error("Failed to read file"));
                    reader.readAsDataURL(file);
                });
            };

            const analyzeWithAI = async () => {
                if (uploadedImages.length === 0) return;

                setAnalyzing(true);

                try {
                    // Extraer colores de todas las imágenes
                    const allColors = [];
                    for (const img of uploadedImages) {
                        const colors = await extractColors(img.url, 8);
                        allColors.push(...colors);
                    }

                    // Convertir la primera imagen a base64 para análisis IA
                    const imageBase64 = await imageToBase64(uploadedImages[0].file);
                    const imageType = uploadedImages[0].file.type;

                    console.log('Iniciando análisis con IA...');

                    // Llamar a la API de Claude para análisis
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 4000,
                            messages: [
                                {
                                    role: "user",
                                    content: [
                                        {
                                            type: "image",
                                            source: {
                                                type: "base64",
                                                media_type: imageType,
                                                data: imageBase64,
                                            },
                                        },
                                        {
                                            type: "text",
                                            text: `Eres un experto en análisis de diseño gráfico. Analiza esta imagen y proporciona un análisis detallado en formato JSON.

IMPORTANTE: Tu respuesta debe ser ÚNICAMENTE un objeto JSON válido. No incluyas explicaciones, markdown, ni texto adicional.

Estructura requerida:
{
  "analisis_fenomenologico": {
    "fenomenos_fisicos": ["luz natural", "sombras suaves", "textura rugosa"],
    "fenomenos_biologicos": ["elementos orgánicos", "formas naturales"],
    "fenomenos_sociales": ["estilo urbano", "cultura contemporánea"],
    "fenomenos_psicologicos": ["sensación de calma", "elegancia"]
  },
  "analisis_semiotico": {
    "signos_iconicos": ["formas reconocibles en la imagen"],
    "signos_indiciales": ["elementos que sugieren contexto"],
    "signos_simbolicos": ["símbolos culturales presentes"],
    "mensaje_principal": "mensaje comunicado por la imagen"
  },
  "analisis_formal": {
    "formas_predominantes": ["Circular", "Rectangular", "Orgánica", "Geométrica", "Abstracta", "Lineal"],
    "composicion": "Simétrica",
    "contraste": "Alto",
    "ritmo": "Dinámico",
    "jerarquia": "Descripción de jerarquía visual"
  },
  "analisis_estilistico": {
    "estilo_principal": "Minimalista",
    "influencias": ["Bauhaus", "Diseño suizo"],
    "epoca": "Contemporáneo",
    "caracteristicas": ["líneas limpias", "espacios negativos"]
  },
  "sistema_visual": {
    "paleta_conceptual": ["tierra", "natural", "cálido"],
    "texturas": ["rugosa", "lisa", "mate"],
    "patrones": ["geométrico", "orgánico"],
    "dimensionalidad": "Plano"
  },
  "recomendaciones_diseño": {
    "aplicaciones": ["identidad corporativa", "editorial", "web"],
    "publico_objetivo": "adultos 25-45, profesionales",
    "versatilidad": "alta versatilidad en medios digitales e impresos",
    "fortalezas": ["coherencia visual", "adaptabilidad"]
  }
}

Responde SOLO con el JSON, sin formato markdown.`
                                        }
                                    ]
                                }
                            ]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }

                    const data = await response.json();
                    console.log('Respuesta recibida:', data);

                    if (!data.content || !data.content[0] || !data.content[0].text) {
                        throw new Error('Respuesta inesperada de la API');
                    }

                    let analysisText = data.content[0].text;
                    
                    // Limpiar posible formato markdown y espacios
                    analysisText = analysisText
                        .replace(/```json\n?/g, "")
                        .replace(/```\n?/g, "")
                        .replace(/^[^{]*/, "")
                        .replace(/[^}]*$/, "")
                        .trim();
                    
                    console.log('Texto parseado:', analysisText);

                    let analysis;
                    try {
                        analysis = JSON.parse(analysisText);
                    } catch (parseError) {
                        console.error('Error al parsear JSON:', parseError);
                        console.error('Texto que intentó parsear:', analysisText);
                        throw new Error('Error al procesar la respuesta del análisis');
                    }

                    // Validar estructura básica
                    if (!analysis.analisis_formal || !analysis.analisis_estilistico) {
                        console.error('Estructura incompleta:', analysis);
                        throw new Error('El análisis no tiene la estructura esperada');
                    }

                    setAiAnalysis(analysis);
                    setColorPalette(allColors.slice(0, 12));

                    // Configurar matriz morfológica basada en el análisis IA
                    const formas = (analysis.analisis_formal?.formas_predominantes || 
                        ['Circular', 'Rectangular', 'Orgánica', 'Geométrica', 'Abstracta', 'Lineal'])
                        .slice(0, 6);
                    
                    const estilos = [
                        analysis.analisis_estilistico?.estilo_principal || 'Moderno',
                        ...(analysis.analisis_estilistico?.influencias || ['Minimalista', 'Ornamental'])
                    ].slice(0, 6);

                    const composiciones = [
                        analysis.analisis_formal?.composicion || 'Asimétrica',
                        'Simétrica',
                        'Radial',
                        'Focal',
                        'Dinámica',
                        'Estática'
                    ].slice(0, 6);

                    setMorphologicalMatrix({
                        A: formas.map((f, i) => ({ id: i + 1, value: f })),
                        B: allColors.slice(0, 8).map((c, i) => ({ id: i + 1, value: c.hex, color: c })),
                        C: estilos.map((e, i) => ({ id: i + 1, value: e })),
                        D: composiciones.map((c, i) => ({ id: i + 1, value: c }))
                    });

                    setActiveTab('ia-analisis');
                } catch (error) {
                    console.error('Error completo:', error);
                    alert(`Error al realizar el análisis con IA: ${error.message}\n\nPor favor, verifica la consola del navegador para más detalles.`);
                } finally {
                    setAnalyzing(false);
                }
            };

            const toggleOption = (category, optionId) => {
                setSelectedOptions(prev => {
                    const current = prev[category];
                    const newSelection = current.includes(optionId)
                        ? current.filter(id => id !== optionId)
                        : [...current, optionId];
                    return { ...prev, [category]: newSelection };
                });
            };

            const generateVariations = () => {
                const hasSelections = Object.values(selectedOptions).some(arr => arr.length > 0);
                if (!hasSelections) {
                    alert('Por favor, selecciona al menos una opción');
                    return;
                }

                const variations = [];
                const maxVariations = 12;

                for (let i = 0; i < maxVariations; i++) {
                    const forma = selectedOptions.A.length > 0
                        ? morphologicalMatrix.A.find(f => f.id === selectedOptions.A[Math.floor(Math.random() * selectedOptions.A.length)])
                        : morphologicalMatrix.A[0];

                    const color = selectedOptions.B.length > 0
                        ? morphologicalMatrix.B.find(c => c.id === selectedOptions.B[Math.floor(Math.random() * selectedOptions.B.length)])
                        : morphologicalMatrix.B[0];

                    const estilo = selectedOptions.C.length > 0
                        ? morphologicalMatrix.C.find(e => e.id === selectedOptions.C[Math.floor(Math.random() * selectedOptions.C.length)])
                        : morphologicalMatrix.C[0];

                    const composicion = selectedOptions.D.length > 0
                        ? morphologicalMatrix.D.find(c => c.id === selectedOptions.D[Math.floor(Math.random() * selectedOptions.D.length)])
                        : morphologicalMatrix.D[0];

                    variations.push({
                        id: i + 1,
                        codigo: `A${forma.id}+B${color.id}+C${estilo.id}+D${composicion.id}`,
                        forma: forma.value,
                        color: color.value,
                        estilo: estilo.value,
                        composicion: composicion.value
                    });
                }

                setGeneratedVariations(variations);
                setActiveTab('resultados');
            };

            const generateMockups = async () => {
                if (generatedVariations.length === 0) return;

                setGeneratingMockups(true);

                try {
                    // Seleccionar 3-4 variaciones para mockups
                    const selectedVariations = generatedVariations.slice(0, 4);
                    
                    const mockupTemplates = [
                        { type: 'social', name: 'Publicación Redes Sociales', width: 1080, height: 1080, icon: '📱' },
                        { type: 'story', name: 'Instagram Story', width: 1080, height: 1920, icon: '📲' },
                        { type: 'banner', name: 'Banner Web', width: 1920, height: 600, icon: '🖥️' },
                        { type: 'poster', name: 'Cartel/Poster', width: 800, height: 1200, icon: '🎨' },
                        { type: 'business', name: 'Tarjeta de Presentación', width: 1050, height: 600, icon: '💼' },
                        { type: 'newsletter', name: 'Header Newsletter', width: 600, height: 400, icon: '📧' }
                    ];

                    const generatedMockups = [];

                    for (const template of mockupTemplates) {
                        const variation = selectedVariations[Math.floor(Math.random() * selectedVariations.length)];
                        
                        generatedMockups.push({
                            id: Math.random().toString(36),
                            template: template,
                            variation: variation,
                            svg: generateMockupSVG(template, variation)
                        });
                    }

                    setMockups(generatedMockups);
                    setActiveTab('mockups');
                } catch (error) {
                    console.error('Error al generar mockups:', error);
                } finally {
                    setGeneratingMockups(false);
                }
            };

            const generateMockupSVG = (template, variation) => {
                const { width, height } = template;
                
                // Generar colores complementarios
                const secondaryColor = adjustColor(variation.color, -30);
                const accentColor = adjustColor(variation.color, 60);

                return `
                    <svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="grad${template.type}" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:${variation.color};stop-opacity:1" />
                                <stop offset="100%" style="stop-color:${secondaryColor};stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <rect width="${width}" height="${height}" fill="url(#grad${template.type})"/>
                        
                        <!-- Elementos decorativos según la forma -->
                        ${generateShapeElements(variation.forma, width, height, accentColor)}
                        
                        <!-- Texto principal -->
                        <text x="${width/2}" y="${height/2 - 50}" font-size="${width/15}" font-weight="bold" 
                              text-anchor="middle" fill="white" font-family="Arial, sans-serif">
                            ${template.name}
                        </text>
                        
                        <!-- Información del sistema -->
                        <text x="${width/2}" y="${height/2 + 20}" font-size="${width/25}" 
                              text-anchor="middle" fill="white" font-family="Arial, sans-serif" opacity="0.9">
                            ${variation.estilo}
                        </text>
                        
                        <text x="${width/2}" y="${height/2 + 60}" font-size="${width/30}" 
                              text-anchor="middle" fill="white" font-family="Arial, sans-serif" opacity="0.8">
                            ${variation.forma} • ${variation.composicion}
                        </text>
                        
                        <!-- Código de variación -->
                        <text x="${width/2}" y="${height - 30}" font-size="${width/40}" 
                              text-anchor="middle" fill="white" font-family="monospace" opacity="0.6">
                            ${variation.codigo}
                        </text>
                    </svg>
                `;
            };

            const generateShapeElements = (forma, width, height, color) => {
                switch (forma.toLowerCase()) {
                    case 'circular':
                        return `
                            <circle cx="${width*0.2}" cy="${height*0.2}" r="${width*0.08}" fill="${color}" opacity="0.3"/>
                            <circle cx="${width*0.8}" cy="${height*0.8}" r="${width*0.1}" fill="${color}" opacity="0.2"/>
                        `;
                    case 'rectangular':
                        return `
                            <rect x="${width*0.1}" y="${height*0.1}" width="${width*0.15}" height="${height*0.15}" fill="${color}" opacity="0.3"/>
                            <rect x="${width*0.75}" y="${height*0.75}" width="${width*0.2}" height="${height*0.2}" fill="${color}" opacity="0.2"/>
                        `;
                    case 'triangular':
                        return `
                            <polygon points="${width*0.2},${height*0.3} ${width*0.1},${height*0.1} ${width*0.3},${height*0.1}" fill="${color}" opacity="0.3"/>
                            <polygon points="${width*0.8},${height*0.7} ${width*0.7},${height*0.9} ${width*0.9},${height*0.9}" fill="${color}" opacity="0.2"/>
                        `;
                    default:
                        return `
                            <ellipse cx="${width*0.2}" cy="${height*0.2}" rx="${width*0.1}" ry="${height*0.06}" fill="${color}" opacity="0.3"/>
                            <ellipse cx="${width*0.8}" cy="${height*0.8}" rx="${width*0.08}" ry="${height*0.12}" fill="${color}" opacity="0.2"/>
                        `;
                }
            };

            // Generar SVG para representar una forma
            const generateFormaSVG = (forma, color = '#5C7CFA') => {
                const size = 120;
                const center = size / 2;
                
                switch (forma.toLowerCase()) {
                    case 'circular':
                    case 'circle':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="${center}" cy="${center}" r="${size * 0.35}" fill="${color}" opacity="0.8"/>
                                <circle cx="${center}" cy="${center}" r="${size * 0.25}" fill="white" opacity="0.3"/>
                            </svg>
                        `;
                    case 'rectangular':
                    case 'rectangle':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <rect x="${size * 0.15}" y="${size * 0.25}" width="${size * 0.7}" height="${size * 0.5}" fill="${color}" opacity="0.8" rx="4"/>
                                <rect x="${size * 0.25}" y="${size * 0.35}" width="${size * 0.5}" height="${size * 0.3}" fill="white" opacity="0.3"/>
                            </svg>
                        `;
                    case 'triangular':
                    case 'triangle':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <polygon points="${center},${size*0.15} ${size*0.15},${size*0.85} ${size*0.85},${size*0.85}" fill="${color}" opacity="0.8"/>
                                <polygon points="${center},${size*0.35} ${size*0.3},${size*0.75} ${size*0.7},${size*0.75}" fill="white" opacity="0.3"/>
                            </svg>
                        `;
                    case 'orgánica':
                    case 'organic':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <path d="M ${center} ${size*0.2} Q ${size*0.8} ${size*0.3} ${size*0.75} ${center} T ${center} ${size*0.8} Q ${size*0.2} ${size*0.7} ${size*0.25} ${center} T ${center} ${size*0.2}" fill="${color}" opacity="0.8"/>
                                <ellipse cx="${center}" cy="${center}" rx="${size*0.2}" ry="${size*0.15}" fill="white" opacity="0.3"/>
                            </svg>
                        `;
                    case 'geométrica':
                    case 'geometric':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <polygon points="${center},${size*0.2} ${size*0.8},${center} ${center},${size*0.8} ${size*0.2},${center}" fill="${color}" opacity="0.8"/>
                                <rect x="${size*0.4}" y="${size*0.4}" width="${size*0.2}" height="${size*0.2}" fill="white" opacity="0.3"/>
                            </svg>
                        `;
                    case 'abstracta':
                    case 'abstract':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <path d="M ${size*0.2} ${center} L ${size*0.5} ${size*0.2} L ${size*0.8} ${size*0.6} L ${size*0.6} ${size*0.8} L ${size*0.3} ${size*0.7} Z" fill="${color}" opacity="0.8"/>
                                <circle cx="${center}" cy="${center}" r="${size*0.15}" fill="white" opacity="0.3"/>
                            </svg>
                        `;
                    case 'lineal':
                    case 'linear':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <line x1="${size*0.2}" y1="${size*0.3}" x2="${size*0.8}" y2="${size*0.3}" stroke="${color}" stroke-width="8" opacity="0.8"/>
                                <line x1="${size*0.2}" y1="${center}" x2="${size*0.8}" y2="${center}" stroke="${color}" stroke-width="6" opacity="0.6"/>
                                <line x1="${size*0.2}" y1="${size*0.7}" x2="${size*0.8}" y2="${size*0.7}" stroke="${color}" stroke-width="4" opacity="0.4"/>
                            </svg>
                        `;
                    default:
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="${center}" cy="${center}" r="${size * 0.35}" fill="${color}" opacity="0.8"/>
                            </svg>
                        `;
                }
            };

            // Generar SVG para representar composición
            const generateComposicionSVG = (tipo, color = '#5C7CFA') => {
                const size = 120;
                const center = size / 2;
                
                switch (tipo.toLowerCase()) {
                    case 'simétrica':
                    case 'symmetrical':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <rect x="${size*0.15}" y="${size*0.15}" width="${size*0.25}" height="${size*0.7}" fill="${color}" opacity="0.8"/>
                                <rect x="${size*0.6}" y="${size*0.15}" width="${size*0.25}" height="${size*0.7}" fill="${color}" opacity="0.8"/>
                                <line x1="${center}" y1="${size*0.1}" x2="${center}" y2="${size*0.9}" stroke="#999" stroke-width="1" stroke-dasharray="4,4"/>
                            </svg>
                        `;
                    case 'asimétrica':
                    case 'asymmetrical':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <rect x="${size*0.1}" y="${size*0.2}" width="${size*0.3}" height="${size*0.6}" fill="${color}" opacity="0.8"/>
                                <rect x="${size*0.55}" y="${size*0.35}" width="${size*0.35}" height="${size*0.3}" fill="${color}" opacity="0.6"/>
                                <circle cx="${size*0.7}" cy="${size*0.25}" r="${size*0.08}" fill="${color}" opacity="0.4"/>
                            </svg>
                        `;
                    case 'radial':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="${center}" cy="${center}" r="${size*0.1}" fill="${color}" opacity="0.9"/>
                                <circle cx="${center}" cy="${center}" r="${size*0.2}" fill="${color}" opacity="0.6"/>
                                <circle cx="${center}" cy="${center}" r="${size*0.3}" fill="${color}" opacity="0.3"/>
                            </svg>
                        `;
                    case 'focal':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <circle cx="${center}" cy="${center}" r="${size*0.25}" fill="${color}" opacity="0.9"/>
                                <rect x="${size*0.1}" y="${size*0.1}" width="${size*0.15}" height="${size*0.15}" fill="${color}" opacity="0.3"/>
                                <rect x="${size*0.75}" y="${size*0.75}" width="${size*0.15}" height="${size*0.15}" fill="${color}" opacity="0.3"/>
                            </svg>
                        `;
                    case 'dinámica':
                    case 'dynamic':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <polygon points="${size*0.2},${size*0.7} ${size*0.4},${size*0.2} ${size*0.7},${size*0.5} ${size*0.9},${size*0.3}" fill="${color}" opacity="0.8" stroke="${color}" stroke-width="3" fill="none"/>
                                <circle cx="${size*0.4}" cy="${size*0.2}" r="${size*0.08}" fill="${color}"/>
                            </svg>
                        `;
                    case 'estática':
                    case 'static':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <rect x="${size*0.25}" y="${size*0.25}" width="${size*0.5}" height="${size*0.5}" fill="${color}" opacity="0.8"/>
                                <rect x="${size*0.35}" y="${size*0.35}" width="${size*0.3}" height="${size*0.3}" fill="white" opacity="0.3"/>
                            </svg>
                        `;
                    default:
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <rect x="${size*0.2}" y="${size*0.2}" width="${size*0.6}" height="${size*0.6}" fill="${color}" opacity="0.8"/>
                            </svg>
                        `;
                }
            };

            // Generar SVG para representar textura
            const generateTexturaSVG = (tipo, color = '#5C7CFA') => {
                const size = 120;
                
                switch (tipo.toLowerCase()) {
                    case 'rugosa':
                    case 'rough':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                ${Array.from({length: 100}, (_, i) => {
                                    const x = Math.random() * size;
                                    const y = Math.random() * size;
                                    const r = Math.random() * 2 + 1;
                                    return `<circle cx="${x}" cy="${y}" r="${r}" fill="${color}" opacity="0.6"/>`;
                                }).join('')}
                            </svg>
                        `;
                    case 'lisa':
                    case 'smooth':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <linearGradient id="smooth" x1="0%" y1="0%" x2="100%" y2="100%">
                                        <stop offset="0%" style="stop-color:${color};stop-opacity:0.8" />
                                        <stop offset="100%" style="stop-color:${color};stop-opacity:0.3" />
                                    </linearGradient>
                                </defs>
                                <rect width="${size}" height="${size}" fill="url(#smooth)"/>
                            </svg>
                        `;
                    case 'mate':
                    case 'matte':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <rect width="${size}" height="${size}" fill="${color}" opacity="0.7"/>
                            </svg>
                        `;
                    case 'brillante':
                    case 'glossy':
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <defs>
                                    <radialGradient id="glossy">
                                        <stop offset="0%" style="stop-color:white;stop-opacity:0.8" />
                                        <stop offset="50%" style="stop-color:${color};stop-opacity:0.9" />
                                        <stop offset="100%" style="stop-color:${color};stop-opacity:1" />
                                    </radialGradient>
                                </defs>
                                <rect width="${size}" height="${size}" fill="url(#glossy)"/>
                            </svg>
                        `;
                    default:
                        return `
                            <svg width="${size}" height="${size}" xmlns="http://www.w3.org/2000/svg">
                                <rect width="${size}" height="${size}" fill="${color}" opacity="0.6"/>
                            </svg>
                        `;
                }
            };

            const adjustColor = (hex, amount) => {
                const num = parseInt(hex.replace('#', ''), 16);
                const r = Math.min(255, Math.max(0, (num >> 16) + amount));
                const g = Math.min(255, Math.max(0, ((num >> 8) & 0x00FF) + amount));
                const b = Math.min(255, Math.max(0, (num & 0x0000FF) + amount));
                return '#' + ((r << 16) | (g << 8) | b).toString(16).padStart(6, '0');
            };

            const downloadMockup = (mockup) => {
                const blob = new Blob([mockup.svg], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mockup_${mockup.template.type}_${mockup.variation.codigo}.svg`;
                a.click();
                URL.revokeObjectURL(url);
            };

            const downloadVariation = (variation) => {
                const svg = `
                    <svg width="800" height="800" xmlns="http://www.w3.org/2000/svg">
                        <rect width="800" height="800" fill="${variation.color}"/>
                        <text x="400" y="300" font-size="48" font-weight="bold" text-anchor="middle" fill="white">
                            ${variation.forma}
                        </text>
                        <text x="400" y="400" font-size="36" text-anchor="middle" fill="white">
                            ${variation.estilo}
                        </text>
                        <text x="400" y="500" font-size="32" text-anchor="middle" fill="white">
                            ${variation.composicion}
                        </text>
                        <text x="400" y="650" font-size="24" text-anchor="middle" fill="white" font-family="monospace">
                            ${variation.codigo}
                        </text>
                    </svg>
                `;

                const blob = new Blob([svg], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `variacion_${variation.codigo}.svg`;
                a.click();
                URL.revokeObjectURL(url);
            };

            return (
                <div className="container">
                    <div className="header">
                        <h1>🎨 Sistema Visual Flexible PRO</h1>
                        <p>Generador con Inteligencia Artificial y Mockups Automáticos</p>
                        <div className="badge">
                            <span className="pulse">⚡</span> Powered by Claude AI
                        </div>
                    </div>

                    <div className="content">
                        <div className="tabs">
                            <button
                                className={`tab ${activeTab === 'analisis' ? 'active' : ''}`}
                                onClick={() => setActiveTab('analisis')}
                            >
                                📊 I. Carga
                            </button>
                            <button
                                className={`tab ${activeTab === 'ia-analisis' ? 'active' : ''}`}
                                onClick={() => setActiveTab('ia-analisis')}
                                disabled={!aiAnalysis}
                            >
                                🤖 II. Análisis IA
                            </button>
                            <button
                                className={`tab ${activeTab === 'morfologico' ? 'active' : ''}`}
                                onClick={() => setActiveTab('morfologico')}
                                disabled={!aiAnalysis}
                            >
                                🔢 III. Matriz
                            </button>
                            <button
                                className={`tab ${activeTab === 'resultados' ? 'active' : ''}`}
                                onClick={() => setActiveTab('resultados')}
                                disabled={generatedVariations.length === 0}
                            >
                                ✨ IV. Variaciones
                            </button>
                            <button
                                className={`tab ${activeTab === 'mockups' ? 'active' : ''}`}
                                onClick={() => setActiveTab('mockups')}
                                disabled={mockups.length === 0}
                            >
                                🎨 V. Mockups
                            </button>
                        </div>

                        {/* TAB 1: ANÁLISIS */}
                        {activeTab === 'analisis' && (
                            <div className="module">
                                <h2>📥 Carga de Imágenes de Referencia</h2>
                                <div className="info-box">
                                    <p><strong>🎯 Objetivo:</strong> Sube las imágenes que servirán como referencia visual. La IA analizará los elementos fenomenológicos, semióticos, formales y estilísticos.</p>
                                </div>

                                <div
                                    className={`upload-area ${isDragging ? 'dragging' : ''}`}
                                    onClick={() => fileInputRef.current.click()}
                                    onDrop={handleDrop}
                                    onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}
                                    onDragLeave={() => setIsDragging(false)}
                                >
                                    <input
                                        ref={fileInputRef}
                                        type="file"
                                        multiple
                                        accept="image/*"
                                        style={{ display: 'none' }}
                                        onChange={(e) => handleFileUpload(e.target.files)}
                                    />
                                    <div style={{ fontSize: '3em', marginBottom: '10px' }}>📁</div>
                                    <p style={{ fontSize: '1.2em', marginBottom: '5px' }}>
                                        Arrastra imágenes aquí o haz clic para seleccionar
                                    </p>
                                    <p style={{ color: '#868e96' }}>
                                        JPG, PNG, GIF - Múltiples imágenes recomendadas
                                    </p>
                                </div>

                                {uploadedImages.length > 0 && (
                                    <>
                                        <div className="image-preview">
                                            {uploadedImages.map(img => (
                                                <div key={img.id} className="preview-item">
                                                    <img src={img.url} alt="Preview" />
                                                    <button
                                                        className="remove-btn"
                                                        onClick={() => removeImage(img.id)}
                                                    >
                                                        ×
                                                    </button>
                                                </div>
                                            ))}
                                        </div>

                                        <button
                                            className="analyze-btn"
                                            onClick={analyzeWithAI}
                                            disabled={analyzing}
                                        >
                                            {analyzing ? '🤖 Analizando con IA...' : '🔍 Analizar con Inteligencia Artificial'}
                                        </button>
                                    </>
                                )}

                                {analyzing && (
                                    <div className="loading">
                                        <div className="spinner"></div>
                                        <p>Claude está analizando tus imágenes...</p>
                                        <p style={{ fontSize: '0.9em', color: '#868e96', marginTop: '10px' }}>
                                            Esto puede tomar 10-30 segundos
                                        </p>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* TAB 2: ANÁLISIS IA */}
                        {activeTab === 'ia-analisis' && aiAnalysis && (
                            <div className="module">
                                <h2>🤖 Análisis Multimodal con IA <span className="ai-badge">✨ Claude AI</span></h2>

                                {/* Análisis Fenomenológico */}
                                <div className="analysis-section">
                                    <h3>🌊 Análisis Fenomenológico</h3>
                                    <div className="analysis-content">
                                        <p><strong>Fenómenos Físicos:</strong></p>
                                        <div>
                                            {aiAnalysis.analisis_fenomenologico?.fenomenos_fisicos?.map((f, i) => (
                                                <span key={i} className="tag">{f}</span>
                                            ))}
                                        </div>
                                        
                                        <p style={{ marginTop: '15px' }}><strong>Fenómenos Biológicos:</strong></p>
                                        <div>
                                            {aiAnalysis.analisis_fenomenologico?.fenomenos_biologicos?.map((f, i) => (
                                                <span key={i} className="tag">{f}</span>
                                            ))}
                                        </div>

                                        <p style={{ marginTop: '15px' }}><strong>Fenómenos Sociales:</strong></p>
                                        <div>
                                            {aiAnalysis.analisis_fenomenologico?.fenomenos_sociales?.map((f, i) => (
                                                <span key={i} className="tag">{f}</span>
                                            ))}
                                        </div>

                                        <p style={{ marginTop: '15px' }}><strong>Fenómenos Psicológicos:</strong></p>
                                        <div>
                                            {aiAnalysis.analisis_fenomenologico?.fenomenos_psicologicos?.map((f, i) => (
                                                <span key={i} className="tag">{f}</span>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Análisis Semiótico */}
                                <div className="analysis-section">
                                    <h3>🔍 Análisis Semiótico</h3>
                                    <div className="analysis-content">
                                        <p><strong>Signos Icónicos:</strong></p>
                                        <ul>
                                            {aiAnalysis.analisis_semiotico?.signos_iconicos?.map((s, i) => (
                                                <li key={i}>{s}</li>
                                            ))}
                                        </ul>

                                        <p style={{ marginTop: '15px' }}><strong>Signos Indiciales:</strong></p>
                                        <ul>
                                            {aiAnalysis.analisis_semiotico?.signos_indiciales?.map((s, i) => (
                                                <li key={i}>{s}</li>
                                            ))}
                                        </ul>

                                        <p style={{ marginTop: '15px' }}><strong>Signos Simbólicos:</strong></p>
                                        <ul>
                                            {aiAnalysis.analisis_semiotico?.signos_simbolicos?.map((s, i) => (
                                                <li key={i}>{s}</li>
                                            ))}
                                        </ul>

                                        <div style={{ background: '#e7f5ff', padding: '15px', borderRadius: '8px', marginTop: '15px' }}>
                                            <p><strong>💬 Mensaje Principal:</strong></p>
                                            <p style={{ marginTop: '8px' }}>{aiAnalysis.analisis_semiotico?.mensaje_principal}</p>
                                        </div>
                                    </div>
                                </div>

                                {/* Análisis Formal */}
                                <div className="analysis-section">
                                    <h3>📐 Análisis Formal</h3>
                                    <div className="analysis-content">
                                        <p><strong>Formas Predominantes:</strong></p>
                                        <div>
                                            {aiAnalysis.analisis_formal?.formas_predominantes?.map((f, i) => (
                                                <span key={i} className="tag">{f}</span>
                                            ))}
                                        </div>

                                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginTop: '15px' }}>
                                            <div>
                                                <p><strong>Composición:</strong></p>
                                                <p>{aiAnalysis.analisis_formal?.composicion}</p>
                                            </div>
                                            <div>
                                                <p><strong>Contraste:</strong></p>
                                                <p>{aiAnalysis.analisis_formal?.contraste}</p>
                                            </div>
                                            <div>
                                                <p><strong>Ritmo:</strong></p>
                                                <p>{aiAnalysis.analisis_formal?.ritmo}</p>
                                            </div>
                                            <div>
                                                <p><strong>Jerarquía:</strong></p>
                                                <p>{aiAnalysis.analisis_formal?.jerarquia}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                {/* Análisis Estilístico */}
                                <div className="analysis-section">
                                    <h3>🎨 Análisis Estilístico</h3>
                                    <div className="analysis-content">
                                        <p><strong>Estilo Principal:</strong> {aiAnalysis.analisis_estilistico?.estilo_principal}</p>
                                        
                                        <p style={{ marginTop: '15px' }}><strong>Influencias:</strong></p>
                                        <div>
                                            {aiAnalysis.analisis_estilistico?.influencias?.map((i, idx) => (
                                                <span key={idx} className="tag">{i}</span>
                                            ))}
                                        </div>

                                        <p style={{ marginTop: '15px' }}><strong>Época:</strong> {aiAnalysis.analisis_estilistico?.epoca}</p>

                                        <p style={{ marginTop: '15px' }}><strong>Características:</strong></p>
                                        <ul>
                                            {aiAnalysis.analisis_estilistico?.caracteristicas?.map((c, i) => (
                                                <li key={i}>{c}</li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>

                                {/* Sistema Visual */}
                                <div className="analysis-section">
                                    <h3>🎨 Sistema Cromático Extraído</h3>
                                    <div className="color-palette">
                                        {colorPalette.map((color, idx) => (
                                            <div key={idx} className="color-item">
                                                <div
                                                    className="color-swatch"
                                                    style={{ backgroundColor: color.hex }}
                                                    title={color.hex}
                                                ></div>
                                                <div className="color-code">{color.hex}</div>
                                            </div>
                                        ))}
                                    </div>

                                    <div style={{ marginTop: '20px' }}>
                                        <p><strong>Paleta Conceptual:</strong></p>
                                        <div>
                                            {aiAnalysis.sistema_visual?.paleta_conceptual?.map((p, i) => (
                                                <span key={i} className="tag">{p}</span>
                                            ))}
                                        </div>

                                        <p style={{ marginTop: '15px' }}><strong>Texturas:</strong></p>
                                        <div>
                                            {aiAnalysis.sistema_visual?.texturas?.map((t, i) => (
                                                <span key={i} className="tag">{t}</span>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* Recomendaciones */}
                                <div className="analysis-section">
                                    <h3>💡 Recomendaciones de Diseño</h3>
                                    <div className="analysis-content">
                                        <p><strong>Aplicaciones Recomendadas:</strong></p>
                                        <ul>
                                            {aiAnalysis.recomendaciones_diseño?.aplicaciones?.map((a, i) => (
                                                <li key={i}>{a}</li>
                                            ))}
                                        </ul>

                                        <p style={{ marginTop: '15px' }}><strong>Público Objetivo:</strong> {aiAnalysis.recomendaciones_diseño?.publico_objetivo}</p>
                                        <p style={{ marginTop: '10px' }}><strong>Versatilidad:</strong> {aiAnalysis.recomendaciones_diseño?.versatilidad}</p>

                                        <p style={{ marginTop: '15px' }}><strong>Fortalezas del Diseño:</strong></p>
                                        <ul>
                                            {aiAnalysis.recomendaciones_diseño?.fortalezas?.map((f, i) => (
                                                <li key={i}>{f}</li>
                                            ))}
                                        </ul>
                                    </div>
                                </div>

                                <div className="info-box" style={{ marginTop: '30px' }}>
                                    <p><strong>✓ Análisis completado.</strong> Procede al siguiente módulo para configurar la matriz morfológica basada en estos hallazgos.</p>
                                </div>
                            </div>
                        )}

                        {/* TAB 3: MATRIZ MORFOLÓGICA */}
                        {activeTab === 'morfologico' && aiAnalysis && (
                            <div className="module">
                                <h2>🔢 Matriz Morfológica</h2>
                                <div className="info-box">
                                    <p><strong>Análisis Morfológico:</strong> Selecciona variables de cada dimensión para generar combinaciones únicas. Las opciones han sido configuradas automáticamente basándose en el análisis IA.</p>
                                </div>

                                {/* Dimensión A: Formas */}
                                <div className="form-section">
                                    <h3 style={{ color: '#5C7CFA', marginBottom: '15px' }}>
                                        A. Sistema Formal (Formas)
                                    </h3>
                                    <div className="variation-options">
                                        {morphologicalMatrix.A.map(option => (
                                            <div
                                                key={option.id}
                                                className={`option-chip ${selectedOptions.A.includes(option.id) ? 'selected' : ''}`}
                                                onClick={() => toggleOption('A', option.id)}
                                            >
                                                A{option.id}: {option.value}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Dimensión B: Colores */}
                                <div className="form-section">
                                    <h3 style={{ color: '#5C7CFA', marginBottom: '15px' }}>
                                        B. Sistema Cromático
                                    </h3>
                                    <div className="variation-options">
                                        {morphologicalMatrix.B.map(option => (
                                            <div
                                                key={option.id}
                                                className={`option-chip ${selectedOptions.B.includes(option.id) ? 'selected' : ''}`}
                                                onClick={() => toggleOption('B', option.id)}
                                                style={{
                                                    background: selectedOptions.B.includes(option.id) ? option.value : '#f8f9fa',
                                                    color: selectedOptions.B.includes(option.id) ? '#fff' : '#000',
                                                    borderColor: option.value
                                                }}
                                            >
                                                B{option.id}: {option.value}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Dimensión C: Estilos */}
                                <div className="form-section">
                                    <h3 style={{ color: '#5C7CFA', marginBottom: '15px' }}>
                                        C. Sistema Estilístico
                                    </h3>
                                    <div className="variation-options">
                                        {morphologicalMatrix.C.map(option => (
                                            <div
                                                key={option.id}
                                                className={`option-chip ${selectedOptions.C.includes(option.id) ? 'selected' : ''}`}
                                                onClick={() => toggleOption('C', option.id)}
                                            >
                                                C{option.id}: {option.value}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                {/* Dimensión D: Composición */}
                                <div className="form-section">
                                    <h3 style={{ color: '#5C7CFA', marginBottom: '15px' }}>
                                        D. Sistema Compositivo
                                    </h3>
                                    <div className="variation-options">
                                        {morphologicalMatrix.D.map(option => (
                                            <div
                                                key={option.id}
                                                className={`option-chip ${selectedOptions.D.includes(option.id) ? 'selected' : ''}`}
                                                onClick={() => toggleOption('D', option.id)}
                                            >
                                                D{option.id}: {option.value}
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <button
                                    className="generate-btn"
                                    onClick={generateVariations}
                                >
                                    ✨ Generar Variaciones
                                </button>
                            </div>
                        )}

                        {/* TAB 4: RESULTADOS */}
                        {activeTab === 'resultados' && generatedVariations.length > 0 && (
                            <div className="module">
                                <h2>✨ Variaciones Generadas</h2>
                                
                                <div className="stats-grid">
                                    <div className="stat-card">
                                        <div className="stat-number">{generatedVariations.length}</div>
                                        <div className="stat-label">Variaciones</div>
                                    </div>
                                    <div className="stat-card">
                                        <div className="stat-number">
                                            {morphologicalMatrix.A.length * morphologicalMatrix.B.length * 
                                             morphologicalMatrix.C.length * morphologicalMatrix.D.length}
                                        </div>
                                        <div className="stat-label">Combinaciones Posibles</div>
                                    </div>
                                </div>

                                <button
                                    className="generate-btn"
                                    onClick={generateMockups}
                                    disabled={generatingMockups}
                                    style={{ marginBottom: '20px' }}
                                >
                                    {generatingMockups ? '🎨 Generando Mockups...' : '🎨 Generar Mockups Automáticos'}
                                </button>

                                <div className="results-grid">
                                    {generatedVariations.map(variation => (
                                        <div key={variation.id} className="result-card">
                                            <div
                                                className="result-preview"
                                                style={{ background: variation.color }}
                                            >
                                                {variation.forma.charAt(0)}
                                            </div>
                                            <div style={{ fontSize: '0.85em', color: '#868e96', marginBottom: '10px' }}>
                                                <strong>Código:</strong> {variation.codigo}
                                            </div>
                                            <div style={{ fontSize: '0.9em', marginBottom: '5px' }}>
                                                <strong>Forma:</strong> {variation.forma}
                                            </div>
                                            <div style={{ fontSize: '0.9em', marginBottom: '5px' }}>
                                                <strong>Estilo:</strong> {variation.estilo}
                                            </div>
                                            <div style={{ fontSize: '0.9em', marginBottom: '15px' }}>
                                                <strong>Composición:</strong> {variation.composicion}
                                            </div>
                                            <button
                                                className="download-btn"
                                                onClick={() => downloadVariation(variation)}
                                            >
                                                💾 Descargar SVG
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* TAB 5: MOCKUPS */}
                        {activeTab === 'mockups' && mockups.length > 0 && (
                            <div className="module">
                                <h2>🎨 Mockups Generados Automáticamente</h2>
                                
                                <div className="info-box">
                                    <p><strong>📱 Aplicaciones del Sistema:</strong> Los mockups han sido generados automáticamente aplicando las variaciones del sistema visual en diferentes formatos de medios digitales e impresos.</p>
                                </div>

                                <div className="mockup-grid">
                                    {mockups.map(mockup => (
                                        <div key={mockup.id} className="mockup-card">
                                            <div className="mockup-preview">
                                                <div dangerouslySetInnerHTML={{ __html: mockup.svg }} />
                                            </div>
                                            <div className="mockup-title">
                                                {mockup.template.icon} {mockup.template.name}
                                            </div>
                                            <div className="mockup-info">
                                                {mockup.template.width} × {mockup.template.height}px
                                            </div>
                                            <div className="mockup-info">
                                                Variación: {mockup.variation.codigo}
                                            </div>
                                            <button
                                                className="download-btn"
                                                onClick={() => downloadMockup(mockup)}
                                            >
                                                💾 Descargar Mockup
                                            </button>
                                        </div>
                                    ))}
                                </div>

                                <div className="info-box" style={{ marginTop: '30px' }}>
                                    <p><strong>💡 Tip Educativo:</strong> Los mockups muestran cómo el sistema visual flexible se adapta a diferentes formatos manteniendo coherencia visual. Este es un principio fundamental de las identidades flexibles en diseño contemporáneo.</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<SistemaVisualFlexiblePro />, document.getElementById('root'));
    </script>
</body>
</html>